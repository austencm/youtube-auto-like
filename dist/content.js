(()=>{"use strict";const t=["#top-level-buttons-computed > ytd-toggle-button-renderer:nth-child(1) yt-icon-button","#top-level-buttons-computed > ytd-toggle-button-renderer:nth-child(1) button","#segmented-like-button button","like-button-view-model button"],e=["#top-level-buttons-computed > ytd-toggle-button-renderer:nth-child(2) yt-icon-button","#top-level-buttons-computed > ytd-toggle-button-renderer:nth-child(2) button","#segmented-dislike-button button","dislike-button-view-model button"],s=["#subscribe-button tp-yt-paper-button","#subscribe-button button"];class i{constructor({options:t,log:e}){if(this.options=t,this.status="idle",this.log=e||(()=>{}),this.cache={},this.start=this.start.bind(this),this.options.disabled||"none"===this.options.like_what)return this.log("liker is disabled"),this.pause();document.querySelector("ytd-app").addEventListener("yt-page-data-updated",this.start),this.start()}pause(){this.log("status: idle"),this.status="idle","function"==typeof this.onPause&&this.onPause()}reset(){this.cache={}}waitForButtons(){return this.log("waiting for buttons..."),new Promise((s=>{const i=setInterval((()=>{const o=document.querySelectorAll(t)[0],n=document.querySelectorAll(e)[0];o&&n&&(this.cache.likeButton=o,this.cache.dislikeButton=n,this.log("...buttons ready"),clearInterval(i),s())}),1e3)}))}waitForVideo(){return this.log("waiting for video..."),new Promise((t=>{const e=setInterval((()=>{this.cache.video=document.querySelector(".video-stream"),this.cache.video&&(this.log("...video ready"),clearInterval(e),t())}),1e3)}))}isVideoRated(){return this.cache.likeButton.classList.contains("style-default-active")&&!this.cache.likeButton.classList.contains("size-default")||this.cache.dislikeButton.classList.contains("style-default-active")||"true"===this.cache.likeButton.getAttribute("aria-pressed")||"true"===this.cache.dislikeButton.getAttribute("aria-pressed")}isUserSubscribed(){const t=this.cache.subscribeButton||document.querySelectorAll(s)[0];if(!t)return this.log("no subscribe button found"),!1;if(this.cache.subscribeButton=t,t.hasAttribute("subscribed")||t.classList.contains("yt-spec-button-shape-next--tonal"))return!0;if("subscribed"===this.options.like_what){const e=t=>{this.log("user subscribed"),t.target.removeEventListener(t.type,e),"idle"===this.status&&this.start()};t.addEventListener("click",e)}return!1}isAdPlaying(){return this.cache.video&&["ad-showing","ad-interrupting"].every((t=>this.cache.video.closest(".html5-video-player").classList.contains(t)))}async clickLike(){return await this.waitForButtons(),this.isVideoRated()?(this.log("video already rated"),this.pause()):"subscribed"!==this.options.like_what||this.isUserSubscribed()?(this.cache.likeButton.click(),this.log("like button clicked"),void this.pause()):(this.log("user not subscribed"),this.pause())}async start(){switch(this.log("status: running"),this.status="running",this.cache={},this.options.like_when){case"timed":{const t=parseFloat(this.options.like_when_minutes);await this.waitForVideo();const{video:e}=this.cache,s=i=>{this.isAdPlaying()||(e.currentTime>=60*t||e.currentTime>=e.duration)&&(this.clickLike(),e.removeEventListener("timeupdate",s))};e.addEventListener("timeupdate",s);break}case"percent":{const t=parseFloat(this.options.like_when_percent)/100;await this.waitForVideo();const{video:e}=this.cache,s=i=>{this.isAdPlaying()||e.currentTime/e.duration>=t&&(this.clickLike(),e.removeEventListener("timeupdate",s))};e.addEventListener("timeupdate",s);break}default:this.clickLike()}}}class o{constructor(t){this.defaults=t,this.get=this.get.bind(this)}get(){return new Promise(((t,e)=>{chrome.storage.sync.get({options:this.defaults},(e=>t(e.options)))}))}set(t){return new Promise(((e,s)=>{chrome.storage.sync.set({options:t},e)}))}}const n=new class{constructor(){this.messages=[],this.log=this.log.bind(this),this.save=this.save.bind(this),this.log(`YouTube Auto Like v${chrome.runtime.getManifest().version}`),this.log((new Date).toDateString()),this.log("User agent:",`\n${window.navigator.userAgent}`)}log(){const t=Array.from(arguments).join(" ");this.messages.push(t)}save(){return new Promise((t=>{chrome.storage.sync.set({log:this.messages.join("\n")},t)}))}};!async function(){try{n.log("navigated:",window.location.href);const t=new o({like_what:"subscribed",like_when:"instantly",like_when_minutes:"2",like_when_percent:"50",disabled:!1});n.log("loading options...");const e=await t.get();n.log("...options loaded",`(${JSON.stringify(e,null,2)})`),new i({options:e,log:n.log}).onPause=n.save}catch(t){n.log(t)}finally{n.save()}}()})();